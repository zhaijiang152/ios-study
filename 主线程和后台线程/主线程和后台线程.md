# 主线程和后台线程

### 在 iOS/macOS 开发中，**每个应用有且仅有一条主线程**（Main Thread/UI Thread），这是由系统强制规定的设计原则。可以创建多条后台线程



### **1. 主线程的唯一性**

**系统强制规定**：iOS/macOS 应用启动时，系统会自动创建一条主线程，负责所有 UI 相关的操作（如渲染界面、处理用户交互）

**无法手动创建**：开发者不能通过代码创建第二条主线程，任何尝试修改主线程属性的操作（如堆栈大小）均会被系统忽略

### **2. 主线程的特殊性**

**UI 操作限制**：所有 UIKit/AppKit 的界面更新必须在主线程执行，否则会导致未定义行为或崩溃

**RunLoop 机制**：主线程默认运行 `NSRunLoop`，用于处理事件（如触摸、定时器）

### **3. 多线程与主线程的关系**

**后台线程**：开发者可以创建多条后台线程（通过 `NSThread`、`GCD` 或 `NSOperationQueue`），但它们的优先级和资源占用均低于主线程

**线程通信**：后台线程需通过 `DispatchQueue.main.async` 或 `performSelectorOnMainThread:` 将任务派发到主线程执行

### **4. 违反主线程规则的后果**

**UI 更新在非主线程**：会导致界面卡顿、显示异常或直接崩溃

**阻塞主线程**：长时间任务（如网络请求）若在主线程执行，会引发界面冻结，触发系统看门狗（Watchdog）终止应用